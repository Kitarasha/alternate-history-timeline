document.addEventListener("DOMContentLoaded", () => {
    const timeline = document.getElementById("timeline");
    const modal = document.getElementById("modal");
    const modalTitle = document.getElementById("event-title");
    const modalDescription = document.getElementById("event-description");
    const closeModal = document.getElementById("close-modal");

    const startYear = 0; // Начало шкалы времени (0 н.э.)
    const endYear = 2100; // Конец шкалы времени
    const totalYears = endYear - startYear; // Всего лет на таймлайне

    console.log(`Общий диапазон лет: ${totalYears} (от ${startYear} до ${endYear})`);

    // Генерация меток на таймлайне
    const createTimelineMarks = (start, end, step) => {
        for (let year = start; year <= end; year += step) {
            const positionPercent = ((year - start) / totalYears) * 100;
            const mark = document.createElement("div");
            mark.className = "timeline-mark";
            mark.style.left = `${positionPercent}%`;
            mark.textContent = year;
            timeline.appendChild(mark);
        }
    };

    // Создание меток каждые 100 лет
    createTimelineMarks(startYear, endYear, 100);

    // === Новое ===
    // Пример альтернативных сценариев. В будущем можно вынести в отдельный файл или дополнять при загрузке данных.
    // Ключ формата: "год - название события"


   const alternativesData = {
        "300-Великое переселение народов": [
            {
                title: "Интеграция и Федерация",
                color: "#80cbc4",
                scenario: [
                    { year: 345, text: "Римская империя заключает договоры с переселенцами, предоставляя им земли и включая в легионы. Это укрепляет границы и снижает конфликты. Племена получают статус федератов и обязуются защищать империю." },
                    { year: 412, text: "Вандалы заключают союз с римским императором, получая земли в Северной Африке. Это становится началом процветания Карфагена как торгового центра, где смешиваются римская и варварская культуры." },
                    { year: 590, text: "Потомки переселенцев занимают ключевые роли в управлении империей. Первый гот становится консулом, официально представляя интересы федератов в римском сенате." }
                ]
            },
            {
                title: "Полное Разрушение",
                color: "#4db6ac",
                scenario: [
                    { year: 376, text: "Переселенцы привносят свои традиции, ремёсла и верования. Готы обучают римлян новым методам ковки оружия, а римляне делятся архитектурными знаниями. Варварские племена начинают принимать христианство." },
                    { year: 410, text: "Период Второго Возрождения..." },
                    { year: 512, text: "Вместо феодальной раздробленности Европа под управлением..." }
                ]
            },
            {
                title: "Союз Востока и Запада",
                color: "#009688",
                scenario: [
                    { year: 395, text: "Восточная и Западная Римская империи совместно организуют переселение вандалов и аланов в Северную Африку. Варвары получают контроль над территорией, обещая защищать её от вторжений берберов." },
                    { year: 450, text: "На Востоке усиливаются культурные связи с германцами. В Константинополе открывается школа, где изучают как латинский язык, так и германские наречия. Это приводит к первым переводам германских эпосов." },
                    { year: 705, text: "Империя расширяет своё влияние на Восток. Потомки мигрантов основывают новые города в Малой Азии, где смешиваются римские технологии и варварские традиции в строительстве." }
                ]
            }
        ],
        "476-Падение Римской Империи": [
            {
                title: "Германская Империя",
                color: "#80cbc4",
                scenario: [
                    { year: 476, text: "Одоакр создаёт Германскую империю, объединяя варварские племена под своей властью. Римская администрация сохраняется, но германские традиции начинают проникать в управление." },
                    { year: 600, text: "Германская империя расширяет свои территории на север и восток, включая Скандинавию. Варварская культура постепенно ассимилируется с римской, создавая новую мультикультурную цивилизацию." },
                    { year: 750, text: "Империя достигает своего пика, становясь мощным центром торговли и науки. Латинский остаётся официальным языком, но новые наречия развиваются в регионах, укрепляя региональную идентичность." }
                ]
            },
            {
                title: "Восточный Контроль",
                color: "#4db6ac",
                scenario: [
                    { year: 476, text: "После падения Западной империи Константинополь укрепляет своё влияние. Восточная империя направляет войска для защиты Равенны и других стратегических городов." },
                    { year: 650, text: "Византия сохраняет контроль над Италией, Балканами и частью Испании. Бывшие западные провинции начинают перенимать восточные традиции и архитектуру." },
                    { year: 800, text: "Восточная империя становится доминирующей силой в Средиземноморье. Новая культура, объединяющая римские и греческие элементы, определяет дальнейшее развитие Европы." }
                ]
            },
            {
                title: "Разделённая Европа",
                color: "#009688",
                scenario: [
                    { year: 476, text: "После распада Западной империи племена германцев создают независимые королевства. Франки занимают Галлию, вестготы — Испанию, вандалы — Северную Африку." },
                    { year: 700, text: "Европа остаётся раздробленной. Каждый регион развивается автономно, сочетая варварские традиции с остатками римской культуры." },
                    { year: 950, text: "Христианство объединяет Европу духовно, но политически она остаётся разделённой. Первые университеты появляются в бывших римских провинциях, знаменуя начало культурного возрождения." }
                ]
            }
           ],
           "1096-Первый крестовый поход": [
            {
                title: "Успех Крестоносцев",
                color: "#80cbc4",
                scenario: [
                    { year: 1096, text: "Крестоносцы под единым командованием успешно добиваются своей цели — захвата Иерусалима. Они основывают Иерусалимское королевство, которое становится центром христианского присутствия на Востоке." },
                    { year: 1296, text: "Крестоносные государства укрепляют свои позиции, став посредниками между Европой и Востоком. Европа активно перенимает восточные технологии, медицину и философию, что ускоряет её развитие и закладывает основу для Возрождения." },
                    { year: 1496, text: "Обогащённая знаниями и ресурсами с Востока, Европа становится экономически и культурно доминирующим регионом. Крестоносные государства всё ещё существуют, что приводит к формированию уникальной христианско-мусульманской культуры." }
                ]
            },
            {
                title: "Провал Крестоносцев",
                color: "#4db6ac",
                scenario: [
                    { year: 1096, text: "Крестоносцы сталкиваются с мощным сопротивлением сельджуков. Большая часть армии погибает, а оставшиеся разрозненные отряды возвращаются в Европу. Попытка объединить силы проваливается." },
                    { year: 1296, text: "Отсутствие влияния Востока тормозит развитие Европы. Османская империя укрепляется и захватывает ключевые византийские территории, включая Константинополь. Европа остаётся изолированной и погружается в экономический застой." },
                    { year: 1596, text: "Османская империя доминирует на Востоке и в Средиземноморье, угрожая даже западным европейским державам. Европейская культура остаётся на локальном уровне, и технологическое развитие сильно отстаёт." }
                ]
            },
            {
                title: "Альтернативный Поход Знаний",
                color: "#009688",
                scenario: [
                    { year: 1096, text: "Вместо военного похода христианские лидеры решают организовать «Крестовый поход знаний». Вместо захвата Иерусалима, крестоносцы направляют усилия на установление культурных и научных связей с Востоком." },
                    { year: 1296, text: "Европа превращается в центр науки благодаря знаниям, привезённым с Востока. Развиваются математика, медицина и астрономия. Город Тулуза становится европейским аналогом Багдада — центром мировой науки." },
                    { year: 1596, text: "Научное сотрудничество между Востоком и Западом приводит к технологической революции. Первая паровая машина создаётся в 16 веке, а корабли с ранними механическими двигателями бороздят моря, открывая новые земли." }
                ]
            }
          ],
          "1440-Изобретение печатного станкa": [
            {
                title: "Быстрое распространение знаний",
                color: "#80cbc4",
                scenario: [
                    { year: 1440, text: "Иоганн Гутенберг изобретает печатный станок, и первые книги, включая Библию, начинают массово печататься. Информация становится доступной широкой аудитории, изменяя общество." },
                    { year: 1640, text: "Благодаря печатным изданиям научные открытия распространяются по всей Европе. Реформация ускоряется, создавая новые социальные и религиозные движения. Образование становится доступным для среднего класса." },
                    { year: 1840, text: "Печатный станок стимулирует промышленную революцию, формируя основу для газетной и книжной индустрии. Распространение знаний по всему миру помогает развитию демократий и социальных реформ." }
                ]
            },
            {
                title: "Ограничение печати",
                color: "#4db6ac",
                scenario: [
                    { year: 1440, text: "Печатный станок изобретён, но его использование строго контролируется церковью и монархией. Книги разрешено печатать только с одобрения властей, что ограничивает свободное распространение знаний." },
                    { year: 1640, text: "Печать остаётся редким явлением, доступным лишь элите. Общество развивает устные традиции, а массовая грамотность отстаёт. Реформация и научные революции замедляются." },
                    { year: 1840, text: "Европа отстаёт в развитии по сравнению с другими регионами, где печатное дело распространяется свободнее. Америка и Китай, где печатное дело не контролируется, становятся мировыми лидерами." }
                ]
            },
            {
                title: "Ранний глобальный прорыв",
                color: "#009688",
                scenario: [
                    { year: 1440, text: "Гутенберг передаёт свою технологию путешествующим купцам, и печатный станок быстро распространяется по миру. В течение 50 лет печать достигает Османской империи, Индии и Китая." },
                    { year: 1640, text: "Глобальное распространение печатных технологий приводит к синтезу знаний между культурами. Китайские открытия в медицине и сельском хозяйстве становятся доступными в Европе, а европейские научные труды читают на Ближнем Востоке." },
                    { year: 1840, text: "Глобализация знаний приводит к раннему развитию технологий, включая электричество и механизацию. В мире создаётся единая научная сеть, а паровые двигатели начинают использоваться на всех континентах." }
                ]
            }
          ],
          "1492-Открытие Америки Колумбом": [
            {
                title: "Быстрая Колонизация",
                color: "#80cbc4",
                scenario: [
                    { year: 1492, text: "Колумб открывает Америку, и Испания быстро начинает экспансию. Первые колонии появляются в Карибском бассейне, за ними следуют исследования материка." },
                    { year: 1692, text: "Колонии охватывают обе Америки. Золото и серебро из Нового Света стимулируют экономическое развитие Европы, но приводят к инфляции. Коренное население страдает от болезней и эксплуатации." },
                    { year: 1892, text: "Америка становится ключевым регионом мира, определяя глобальную торговлю и экономику. Иммигранты из Европы продолжают заселять континенты, создавая многокультурное общество." }
                ]
            },
            {
                title: "Ограниченное освоение",
                color: "#4db6ac",
                scenario: [
                    { year: 1492, text: "Колумб открывает Америку, но его открытия вызывают слабый интерес. Другие европейские державы не спешат финансировать дальнейшие экспедиции." },
                    { year: 1692, text: "Европейцы ограничиваются торговлей с местным населением на побережье. Внутренние территории Америки остаются неосвоенными. Коренные цивилизации, такие как ацтеки и инки, продолжают развиваться." },
                    { year: 1892, text: "Америка остаётся преимущественно независимой. Местные государства формируют собственные альянсы и начинают индустриализацию, вдохновляясь европейскими технологиями." }
                ]
            },
            {
                title: "Американская Империя",
                color: "#009688",
                scenario: [
                    { year: 1492, text: "После открытия Америки Колумб сталкивается с мощными местными цивилизациями. Вместо завоевания он договаривается о союзе с правителями, такими как Монтесума, привозя технологии и создавая торговую сеть." },
                    { year: 1692, text: "Американские цивилизации интегрируют европейские технологии, формируя объединённую империю, охватывающую обе Америки. Европа становится зависимой от американских товаров, таких как какао, табак и картофель." },
                    { year: 1892, text: "Американская Империя становится сверхдержавой, соперничающей с Европой. В её городах смешиваются европейская архитектура и коренные традиции, создавая уникальную культуру, доминирующую на мировой арене." }
                ]
            }
          ],
            "1760-Промышленная революция в Англии": [
            {
                title: "Римская империя не распалась",
                color: "#80cbc4",
                scenario: [
                    { year: 1760, text: "Начинается промышленная революция в Англии. Паровые машины, механизация текстильного производства и развитие металлургии приводят к росту промышленного производства." },
                    { year: 1860, text: "Англия становится мировой фабрикой, распространяя свои технологии по всему миру. Быстрый рост городов и транспортных сетей создаёт урбанизированное общество, стимулируя научные открытия и инженерные инновации." },
                    { year: 1960, text: "Промышленная революция приводит к раннему развитию электроники, космических исследований и биотехнологий. Англия остаётся мировым центром технологического прогресса, задавая тон глобальной индустрии." }
                ]
            },
            {
                title: "Революция тормозится",
                color: "#4db6ac",
                scenario: [
                    { year: 1760, text: "Промышленная революция начинается, но быстро сталкивается с сопротивлением общества. Рабочие движения и страх перед механизацией ограничивают внедрение новых технологий." },
                    { year: 1860, text: "Англия остаётся аграрной державой с минимальным индустриальным развитием. США и Германия обгоняют её, становясь лидерами в мировой промышленности." },
                    { year: 1960, text: "Англия теряет своё влияние на мировую экономику. Промышленный прогресс в других странах создаёт мощные технологические центры, в то время как Англия фокусируется на сельском хозяйстве и торговле." }
                ]
            },
            {
                title: "Ранняя глобализация",
                color: "#009688",
                scenario: [
                    { year: 1760, text: "Промышленная революция в Англии сразу получает международный отклик. Технологии распространяются в Европу, Индию и Китай благодаря активной торговле и инвестициям в колонии." },
                    { year: 1860, text: "Благодаря глобальному обмену технологий, промышленная революция становится мировым явлением. Китай и Индия активно развивают свои производства, сокращая разрыв между Западом и Востоком." },
                    { year: 1960, text: "Глобализация, начатая в 18 веке, приводит к созданию международных корпораций и ранних форм цифровой экономики. Мир более равномерно развит, а Англия сохраняет ключевую роль как торговый и финансовый центр." }
                ]
            }
           ],
            "1914-Первая мировая война": [
            {
                title: "Короткая война",
                color: "#80cbc4",
                scenario: [
                    { year: 1914, text: "Конфликт между державами разгорается, но благодаря успешным дипломатическим усилиям и ограниченным военным действиям война заканчивается уже к концу 1915 года. Договариваются о восстановлении довоенных границ." },
                    { year: 1940, text: "Европа переживает экономический подъём, избегая разрушений мирового масштаба. Германия и Франция становятся партнёрами в промышленности, а США остаются нейтральной державой." },
                    { year: 1990, text: "Европейские страны формируют ранний союз, способствующий экономической интеграции. Вторая мировая война не происходит, и мир входит в XXI век без крупных военных конфликтов." }
                ]
            },
            {
                title: "Долгая и разрушительная война",
                color: "#4db6ac",
                scenario: [
                    { year: 1914, text: "Первая мировая война начинается с агрессивных действий Германии и Австро-Венгрии. Конфликт перерастает в глобальное противостояние с активным участием колоний." },
                    { year: 1930, text: "Война продолжается почти два десятилетия, опустошая Европу. Экономические и социальные кризисы охватывают весь мир, приводя к распаду империй и усилению локальных конфликтов." },
                    { year: 1960, text: "После долгой войны мировая система остаётся раздробленной. Технологическое развитие замедляется, а многие страны остаются в состоянии экономической депрессии." }
                ]
            },
            {
                title: "Конфликт предотвращён",
                color: "#009688",
                scenario: [
                    { year: 1914, text: "Сараевское убийство вызывает напряжение, но кризис предотвращается благодаря посредничеству США и Швейцарии. Дипломатические переговоры приводят к созданию Лиги Наций раньше, чем в реальной истории." },
                    { year: 1940, text: "Без мировой войны колониальные державы начинают мирный процесс деколонизации. Страны, избежавшие разрушений, концентрируются на науке, медицине и транспорте." },
                    { year: 1990, text: "Мир развивается без крупных конфликтов, и космическая эра начинается раньше. Первая колония на Луне появляется к концу века, а международное сотрудничество становится нормой." }
                ]
            }
          ],
            "1969-Высадка человека на Луну": [
            {
                title: "Ускорение космической гонки",
                color: "#80cbc4",
                scenario: [
                    { year: 1969, text: "Человечество впервые ступает на Луну. США утверждают своё лидерство в космической гонке, вдохновляя другие страны на усиление собственных космических программ." },
                    { year: 1999, text: "Лунная база становится реальностью. США и СССР сотрудничают в строительстве постоянной станции, что приводит к началу международной колонизации космоса." },
                    { year: 2069, text: "Первая миссия на Марс завершается успешно. Международные усилия по исследованию дальнего космоса объединяют человечество, создавая единую космическую экономику." }
                ]
            },
            {
                title: "Отказ от космических исследований",
                color: "#4db6ac",
                scenario: [
                    { year: 1969, text: "Высадка на Луну проходит успешно, но высокая стоимость миссий приводит к сокращению финансирования. США и СССР решают сосредоточиться на решении земных проблем." },
                    { year: 1999, text: "Космические исследования ограничиваются спутниковыми технологиями и изучением ближайших планет. Мечта о космической колонизации откладывается на неопределённый срок." },
                    { year: 2069, text: "Лунные миссии остаются историческим достижением, но человечество не возвращается на Луну. Космос остаётся малоизученной территорией, а исследования концентрируются на Земле." }
                ]
            },
            {
                title: "Ранняя космическая цивилизация",
                color: "#009688",
                scenario: [
                    { year: 1969, text: "После успешной высадки на Луну США объявляют о планах постоянного присутствия на спутнике. СССР начинает активное развитие собственной лунной программы, что усиливает конкуренцию." },
                    { year: 1999, text: "Кооперация между США, Россией, Европой и Китаем приводит к созданию первых обитаемых станций на Луне. Лунные ресурсы начинают использоваться для производства энергии и топлива." },
                    { year: 2069, text: "Человечество основывает первые автономные города на Луне. Лунные технологии позволяют осуществить прорыв в межпланетных полётах, открывая дорогу для исследования Солнечной системы." }
                ]
            }
          ],
          "1991-Создание World Wide Web": [
            {
                title: "Быстрое развитие интернета",
                color: "#80cbc4",
                scenario: [
                    { year: 1991, text: "Тим Бернерс-Ли запускает World Wide Web. Учёные и университеты первыми начинают использовать сеть для обмена данными." },
                    { year: 2021, text: "Интернет становится ключевой инфраструктурой для экономики, культуры и образования. Искусственный интеллект, автоматизация и облачные технологии ускоряют развитие человечества." },
                    { year: 2091, text: "Интернет перерастает в глобальную нейросеть, связывающую людей и машины. Физические границы стираются, создавая единое виртуальное пространство для взаимодействия и творчества." }
                ]
            },
            {
                title: "Замедленный рост",
                color: "#4db6ac",
                scenario: [
                    { year: 1991, text: "World Wide Web запускается, но из-за экономических и политических препятствий его развитие замедляется. Интернет остаётся нишевой технологией для учёных и крупных корпораций." },
                    { year: 2021, text: "Интернет ограничен. Доступ к сети имеют только крупные организации, а массовая коммуникация происходит через традиционные медиа. Технологический прогресс замедляется." },
                    { year: 2091, text: "Мир остаётся разделённым, так как интернет не стал универсальным средством связи. Локальные инновации возникают, но без глобального обмена знаний их потенциал ограничен." }
                ]
            },
            {
                title: "Альтернативный цифровой мир",
                color: "#009688",
                scenario: [
                    { year: 1991, text: "World Wide Web не создаётся. Вместо этого доминирующей технологией становится спутниковая связь с закрытыми локальными сетями для регионов и стран." },
                    { year: 2021, text: "Каждая страна развивает свои собственные сетевые технологии, ограничивая международное сотрудничество. Конкуренция в киберпространстве становится частью геополитики." },
                    { year: 2091, text: "Цифровые технологии развиваются неравномерно. Виртуальные миры существуют только в пределах отдельных государств, а глобальная сеть знаний так и не возникает. Однако локальные цифровые проекты приводят к созданию уникальных культурных и технологических экосистем." }
                ]
            }
          ],
          "2002-Основание компании SpaceX": [
            {
                title: "Успешное лидерство в космосе",
                color: "#80cbc4",
                scenario: [
                    { year: 2002, text: "Элон Маск основывает SpaceX с целью удешевить космические полёты и сделать возможным освоение Марса. Первые годы компания сосредотачивается на разработке ракет-носителей." },
                    { year: 2052, text: "SpaceX становится ведущей космической компанией, управляя лунными базами и доставляя оборудование для международных марсианских миссий. Коммерческие полёты на Луну становятся реальностью для состоятельных клиентов." },
                    { year: 2102, text: "Благодаря усилиям SpaceX и партнёрству с другими компаниями и государствами, на Марсе построена первая полностью автономная колония. Космическая инфраструктура охватывает весь Солнечный системы." }
                ]
            },
            {
                title: "Ограниченные успехи",
                color: "#4db6ac",
                scenario: [
                    { year: 2002, text: "SpaceX начинает работу, но из-за экономических и технологических сложностей компания сталкивается с чередой неудач. Государственные космические агентства сохраняют доминирование в отрасли." },
                    { year: 2052, text: "Частные компании играют лишь вспомогательную роль в космосе, занимаясь доставкой спутников и научного оборудования. Колонизация Марса остаётся далёкой перспективой, а исследования сосредотачиваются на Луне." },
                    { year: 2102, text: "SpaceX ограничивается работой с низкоорбитальными спутниками. Освоение космоса продвигается медленно, с акцентом на автоматические станции и зонды." }
                ]
            },
            {
                title: "Космическая конкуренция",
                color: "#009688",
                scenario: [
                    { year: 2002, text: "SpaceX закладывает основу для частных космических полётов, вдохновляя другие компании и страны создавать собственные космические программы. Конкуренция в космической индустрии растёт." },
                    { year: 2052, text: "В мире появляется множество частных компаний, соревнующихся за лидерство в космосе. США, Китай, Индия и ЕС совместно разрабатывают международные станции на Марсе, но каждая страна борется за технологическое преимущество." },
                    { year: 2102, text: "Мир вступает в эпоху «космического капитализма», где крупные корпорации контролируют добычу ресурсов на астероидах и Луне. Космос становится новым экономическим фронтиром, но вопрос об экологическом и политическом контроле остаётся нерешённым." }
                ]
            },
        ]
    };

    // === Новое ===
    // Получаем элементы новых модалок
    const alternativesModal = document.getElementById("alternatives-modal");
    const closeAlternatives = document.getElementById("close-alternatives");
    const alternativesList = document.getElementById("alternatives-list");

    const scenarioModal = document.getElementById("scenario-modal");
    const closeScenario = document.getElementById("close-scenario");
    const scenarioTitle = document.getElementById("scenario-title");
    const scenarioText = document.getElementById("scenario-text");
    const scenarioNext = document.getElementById("scenario-next");

    let currentScenario = [];
    let currentScenarioIndex = 0;

    closeAlternatives.addEventListener("click", () => {
        alternativesModal.classList.remove("show");
    });

    closeScenario.addEventListener("click", () => {
        scenarioModal.classList.remove("show");
        currentScenario = [];
        currentScenarioIndex = 0;
        scenarioText.textContent = "";
    });

    alternativesModal.addEventListener("click", (event) => {
        if (event.target === alternativesModal) {
            alternativesModal.classList.remove("show");
        }
    });

    scenarioModal.addEventListener("click", (event) => {
        if (event.target === scenarioModal) {
            scenarioModal.classList.remove("show");
        }
    });

    scenarioNext.addEventListener("click", () => {
        currentScenarioIndex++;
        if (currentScenarioIndex < currentScenario.length) {
            showScenarioStep(currentScenarioIndex);
        } else {
            scenarioText.textContent += "\n\nКонец альтернативного сценария.";
            scenarioNext.disabled = true;
        }
    });

    // Глобальная переменная для хранения текущего интервала
let currentInterval;

function showScenarioStep(index) {
    scenarioNext.disabled = false;
    scenarioText.textContent = ""; // Очищаем текстовый контейнер
    const fullText = `${currentScenario[index].year} год:\n${currentScenario[index].text}`;
    let charIndex = 0;

    // Путь к изображению для текущего сценария
    const imagePath = currentScenario[index].image || ""; // Убедитесь, что в данных сценария есть поле image
    // Настройка изображения
    if (imagePath) {
        scenarioImage.src = imagePath; // Устанавливаем путь к изображению
        scenarioImage.style.display = "block"; // Показываем картинку
    } else {
        scenarioImage.style.display = "none"; // Скрываем картинку, если её нет
    }
    // Печатаем текст
    if (currentInterval) {
        clearInterval(currentInterval); // Очищаем предыдущий интервал
    }

    // Запускаем новый интервал
    currentInterval = setInterval(() => {
        scenarioText.textContent += fullText.charAt(charIndex);
        charIndex++;
        if (charIndex >= fullText.length) {
            clearInterval(currentInterval); // Останавливаем интервал, когда текст завершён
        }
    }, 5);
}


    function showAlternatives(year, title) {
        const key = `${year}-${title}`;
        const eventAlternatives = alternativesData[key];
        if (!eventAlternatives) return;

        alternativesList.innerHTML = "";
        eventAlternatives.forEach((alt) => {
            const altDiv = document.createElement("div");
            altDiv.className = "alternative-option";
            altDiv.textContent = alt.title;
            altDiv.style.backgroundColor = alt.color || "#444";
            altDiv.addEventListener("click", () => {
                showScenario(alt.scenario);
            });
            alternativesList.appendChild(altDiv);
        });

        alternativesModal.classList.add("show");
    }

    function showScenario(scenario) {
        alternativesModal.classList.remove("show");
        scenarioModal.classList.add("show");
        currentScenario = scenario;
        currentScenarioIndex = 0;
        scenarioNext.disabled = false;
        showScenarioStep(currentScenarioIndex);
    }

    // Загрузка данных из файла timeline_data.json
    fetch('timeline_data.json')
        .then(response => {
            if (!response.ok) {
                throw new Error(`Ошибка загрузки файла: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (!Array.isArray(data) || data.length === 0) {
                console.error("Данные пусты или не являются массивом!");
                return;
            }

            data.forEach(event => {
                const eventYear = event.year;
                console.log(`Обработка события: ${JSON.stringify(event)}`);

                if (!eventYear || isNaN(eventYear)) {
                    console.error(`Некорректный год у события: ${JSON.stringify(event)}`);
                    return;
                }

                const positionPercent = ((eventYear - startYear) / totalYears) * 100;
                console.log(`Событие "${event.title}": Год = ${eventYear}, Позиция = ${positionPercent.toFixed(2)}%`);

                const eventDiv = document.createElement("div");
                eventDiv.className = "event";
                eventDiv.style.left = `${positionPercent}%`;

                eventDiv.setAttribute("data-title", `${eventYear} — ${event.title}`);
                eventDiv.setAttribute("data-description", event.description);

                const circle = document.createElement("div");
                circle.className = "circle";
                eventDiv.appendChild(circle);

                timeline.appendChild(eventDiv);

                eventDiv.addEventListener("click", () => {
                    modalTitle.textContent = `${eventYear} — ${event.title}`;
                    modalDescription.textContent = event.description || "Нет описания для этого события.";
                    modal.classList.add("show");

                    // === Новое ===
                    // Проверяем, есть ли альтернативы
                    const key = `${eventYear}-${event.title}`;
                    let altButton = document.getElementById("view-alternatives-btn");
                    if (!altButton) {
                        altButton = document.createElement("button");
                        altButton.id = "view-alternatives-btn";
                        altButton.textContent = "Альтернативные сценарии";
                        modal.querySelector(".modal-content").appendChild(altButton);
                    }
                    const eventAlternatives = alternativesData[key];
                    if (eventAlternatives && eventAlternatives.length > 0) {
                        altButton.style.display = "inline-block";
                        altButton.onclick = () => {
                            showAlternatives(eventYear, event.title);
                        };
                    } else {
                        altButton.style.display = "none";
                    }
                });
            });
        })
        .catch(error => console.error(`Ошибка обработки данных: ${error.message}`));

    closeModal.addEventListener("click", () => {
        modal.classList.remove("show");
    });

    modal.addEventListener("click", (event) => {
        if (event.target === modal) {
            modal.classList.remove("show");
        }
    });

    // Звёздный фон
    const canvas = document.getElementById("stars-canvas");
    const ctx = canvas.getContext("2d");

    let stars = [];
    const numStars = 200;
    const maxLineDistance = 100;
    const mouseRadius = 150;
    const mouse = { x: null, y: null };

    window.addEventListener("mousemove", (event) => {
        mouse.x = event.x;
        mouse.y = event.y;
    });

    window.addEventListener("mouseout", () => {
        mouse.x = null;
        mouse.y = null;
    });

    class Star {
        constructor(x, y, dx, dy, size) {
            this.x = x;
            this.y = y;
            this.dx = dx;
            this.dy = dy;
            this.size = size;
        }

        draw() {
            ctx.beginPath();
            let outerRadius = this.size;
            let innerRadius = this.size / 2;
            let spikes = 5;

            let rotation = Math.PI / 2 * 3;
            let x = this.x;
            let y = this.y;
            ctx.moveTo(x, y - outerRadius);

            for (let i = 0; i < spikes; i++) {
                ctx.lineTo(
                    x + Math.cos(rotation) * outerRadius,
                    y + Math.sin(rotation) * outerRadius
                );
                rotation += Math.PI / spikes;

                ctx.lineTo(
                    x + Math.cos(rotation) * innerRadius,
                    y + Math.sin(rotation) * innerRadius
                );
                rotation += Math.PI / spikes;
            }

            ctx.lineTo(x, y - outerRadius);
            ctx.closePath();
            ctx.fillStyle = "white";
            ctx.fill();
        }

        update() {
            if (this.x + this.size > canvas.width || this.x - this.size < 0) this.dx = -this.dx;
            if (this.y + this.size > canvas.height || this.y - this.size < 0) this.dy = -this.dy;
            this.x += this.dx;
            this.y += this.dy;
            this.draw();
        }
    }

    function initStars() {
        stars = [];
        for (let i = 0; i < numStars; i++) {
            const size = Math.random() * 2 + 1;
            const x = Math.random() * canvas.width;
            const y = Math.random() * canvas.height;
            const dx = (Math.random() - 0.5) * 1;
            const dy = (Math.random() - 0.5) * 1;
            stars.push(new Star(x, y, dx, dy, size));
        }
    }

    function connectStars() {
        for (let i = 0; i < stars.length; i++) {
            for (let j = i + 1; j < stars.length; j++) {
                const distance = Math.sqrt(
                    (stars[i].x - stars[j].x) ** 2 +
                    (stars[i].y - stars[j].y) ** 2
                );
                if (distance < maxLineDistance) {
                    ctx.beginPath();
                    ctx.moveTo(stars[i].x, stars[i].y);
                    ctx.lineTo(stars[j].x, stars[j].y);
                    ctx.strokeStyle = `rgba(255, 255, 255, ${1 - distance / maxLineDistance})`;
                    ctx.lineWidth = 0.5;
                    ctx.stroke();
                }
            }
        }
    }

    function connectToMouse() {
        if (mouse.x !== null && mouse.y !== null) {
            for (let i = 0; i < stars.length; i++) {
                const distance = Math.sqrt(
                    (stars[i].x - mouse.x) ** 2 + (stars[i].y - mouse.y) ** 2
                );
                if (distance < mouseRadius) {
                    ctx.beginPath();
                    ctx.moveTo(stars[i].x, stars[i].y);
                    ctx.lineTo(mouse.x, mouse.y);
                    ctx.strokeStyle = `rgba(255, 255, 255, ${1 - distance / mouseRadius})`;
                    ctx.lineWidth = 0.8;
                    ctx.stroke();
                }
            }
        }
    }

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        initStars();
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        stars.forEach((star) => star.update());
        connectStars();
        connectToMouse();
        requestAnimationFrame(animate);
    }

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
    animate();
});
